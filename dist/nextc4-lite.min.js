!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).nextc4=e()}(this,(function(){"use strict";var t={readUInt32BE:function(t,e,r){if(e+(r=Math.min(r,4))>t.length)throw"Error: exceed the buffer boundary.";for(var n=0,o=0;o<r;++o)n|=t[e+o]<<8*(r-1-o);return n>>>0},writeUInt32BE:function(t,e,r,n){if(e+(n=Math.min(n,4))>t.length)throw"Error: exceed the buffer boundary.";for(var o=n-1;o>=0;o--)t[e+o]=255&r,r>>>=8},toString:function(t){if(!t)return null;for(var e=[],r=0,n=t.length;r<n;++r)e[r]=String.fromCodePoint(t[r]);return e.join("")},toBuffer:function(t){if(!t)return null;for(var e=t.length,r=new Uint32Array(e),n=0,o=0;o<e;++o){var i=t.codePointAt(o);r[n++]=i,i>65535&&o++}return r.slice(0,n)}},e={},r={},n=function(t){var e=typeof t;if("object"===e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var r=Object.prototype.toString.call(t);if("[object Window]"===r)return"object";if("[object Array]"===r||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"===r||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"===e&&void 0===t.call)return"object";return e},o=function(t){var e=typeof t;return"object"===e&&null!=t||"function"===e};r.abstractMethod=function(){throw Error("unimplemented abstract method")},r.nullFunction=function(){},r.inherits=function(t,e){function r(){}r.prototype=e.prototype,t.super_=e.prototype,t.prototype=new r,t.prototype.constructor=t},r.typeOf=n,r.isNull=function(t){return null===t},r.isDefAndNotNull=function(t){return null!=t},r.isArray=function(t){return"array"===n(t)},r.isArrayLike=function(t){var e=n(t);return"array"===e||"object"===e&&"number"==typeof t.length},r.isDateLike=function(t){return o(t)&&"function"==typeof t.getFullYear},r.isString=function(t){return"string"==typeof t},r.isBoolean=function(t){return"boolean"==typeof t},r.isNumber=function(t){return"number"==typeof t},r.isFunction=function(t){return"function"===n(t)},r.isObject=o;const i=r;var s=function(t,e,r){this.decoder_=t,this.encoder_=e,r&&(this.converters_=i.isArray(r)?r.slice():[r])};s.prototype.decoder_,s.prototype.encoder_,s.prototype.converters_,s.prototype.match=function(t){return this.decoder_.match(t)},s.prototype.process=function(t){var e=this.decoder_.decode(t);return e?(this.converters_&&this.converters_.forEach((function(t){e=t.convert(e)}),this),this.encoder_.encode(e)):null},e.Channel=s;var f={};var u=function(t,e){this.name_=t,this.type_=e};u.prototype.name_,u.prototype.type_,u.prototype.description_,u.prototype.version_,u.prototype.getName=function(){return this.name_},u.prototype.getType=function(){return this.type_},f.CharmapType={DECODER:"decoder",CONVERTER:"converter",ENCODER:"encoder"},f.Charmap=u;var c={},a=function(t){this.bytes_=t.length,this.ranges_=t};a.prototype.bytes_,a.prototype.ranges_,a.prototype.getBytes=function(){return this.bytes_},a.prototype.match=function(t){if(!this.bytes_)return!1;for(var e,r=this.bytes_-1;r>=0;--r){if((e=255&t)<this.ranges_[r].from||e>this.ranges_[r].to)return!1;t>>=8}return!0},a.prototype.getBlockSize=function(){if(!this.bytes_)return 0;var t=this.ranges_[this.bytes_-1];return t.to-t.from+1},a.prototype.getBlockCount=function(){if(!this.bytes_)return 0;for(var t=1,e=0;e<this.bytes_-1;++e)t*=this.ranges_[e].to-this.ranges_[e].from+1;return t},a.prototype.getIndexingOffset=function(t){if(!this.bytes_)return-1;for(var e,r=this.getCarries_(),n=0,o=this.bytes_-1;o>=0;--o){if((e=255&t)<this.ranges_[o].from||e>this.ranges_[o].to)return-1;n+=(e-this.ranges_[o].from)*r[o],t>>=8}return n},a.prototype.getCodePoint=function(t){if(!this.bytes_)return-1;for(var e=this.getCarries_(),r=0,n=0;n<this.bytes_;++n)t>=e[n]?(r|=Math.floor(t/e[n])+this.ranges_[n].from<<8*(this.bytes_-1-n),t%=e[n]):r|=this.ranges_[n].from<<8*(this.bytes_-1-n);return r>>>0},a.prototype.getCarries_=function(){if(!this.carries_){this.carries_=[],this.carries_[this.bytes_-1]=1;for(var t=this.bytes_-2;t>=0;--t)this.carries_[t]=this.carries_[t+1]*(this.ranges_[t+1].to-this.ranges_[t+1].from+1)}return this.carries_},a.prototype.consume=function(t,e){if(!this.bytes_)return!1;if(e+this.bytes_>t.length)return!1;for(var r=0;r<this.bytes_;++r)if(t[e+r]<this.ranges_[r].from||t[e+r]>this.ranges_[r].to)return!1;return!0},a.build=function(t){if(!t||!t.length)return null;var e=[];return t.forEach((function(t){var r=t.split("~");if(1===r.length){var n=+r[0];isNaN(n)||e.push({from:n,to:n})}else if(2===r.length){var o=+r[0],i=+r[1];!isNaN(o)&&!isNaN(i)&&o>=0&&o<=255&&i>=0&&i<=255&&e.push({from:Math.min(o,i),to:Math.max(o,i)})}})),e.length?new a(e):null},c.Condition=a;var h={UNICODE_UNKNOWN_CHAR:65533,UNICODE_BYTE_ORDER_MARK:65279};h.UTF8_BOM=new Uint8Array([239,187,191]),h.UTF16LE_BOM=new Uint8Array([255,254]),h.UTF16BE_BOM=new Uint8Array([254,255]),h.MBCS_UNKNOWN_CHAR=63,h.MBCS_WHITE_SPACE={GBK:41377,GB18030:41377},h.EMBEDDED_BASE64_PREFIX="data:application/octet-stream;base64,";var p={},_={};const{Condition:d}=c;var l=function(t){this.begin_=t.begin,this.end_=t.end,this.condition_=d.build(t.condition),this.reference_=t.reference,this.offset_=t.offset,this.characterset_=t.characterset};l.prototype.begin_,l.prototype.end_,l.prototype.condition_,l.prototype.reference_,l.prototype.offset_,l.prototype.characterset_,l.prototype.getBegin=function(){return this.begin_},l.prototype.getEnd=function(){return this.end_},l.prototype.getOffset=function(){return this.offset_},l.prototype.getReference=function(){return this.reference_},l.prototype.getCondition=function(){return this.condition_};var y=function(t){this.segments_=[],t&&t.forEach((function(t){t instanceof l||(t=new l(t)),this.segments_.push(t)}),this)};y.prototype.segments_,y.prototype.find=function(t){for(var e=0,r=this.segments_.length;e<r;++e)if(t>=this.segments_[e].begin_&&t<=this.segments_[e].end_&&(!this.segments_[e].condition_||this.segments_[e].condition_.match(t)))return this.segments_[e];return null},_.Reference={ASCII:"ascii",UNDEFINED:"undefined",BUFFER:"buffer",INDEXING_BUFFER:"indexing-buffer",SELF:"self",GB18030_UNICODE_SP_MAPPING:"gb18030-unicode-sp-mapping"},_.Segment=l,_.Segments=y;var g={};const v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";g.encode=function(t){if(!t)return"";var e=t.length;if(!e)return"";for(var r=[],n=e%3,o=e-n,i=0,s=0,f=0;f<o;f+=3)i=t[f]<<16|t[f+1]<<8|t[f+2],r[s++]=v[i>>>18&63],r[s++]=v[i>>>12&63],r[s++]=v[i>>>6&63],r[s++]=v[63&i];return 1===n?(r[s++]=v[t[o]>>>2&63],r[s++]=v[t[o]<<4&48],r[s++]="=",r[s]="="):2===n&&(r[s++]=v[t[o]>>>2&63],r[s++]=v[t[o]<<4&48|t[o+1]>>>4&15],r[s++]=v[t[o+1]<<2&60],r[s]="="),r.join("")};const E=function(){for(var t={},e=0;e<64;++e)t[v[e]]=e;return t}();g.decode=function(t){if(!t)return new Uint8Array(0);var e=t.length;if(!e)return new Uint8Array(0);t.endsWith("==")?(t=t.substring(0,e-2),e-=2):t.endsWith("=")&&(t=t.substring(0,e-1),e-=1);var r=e%4,n=3*Math.floor(e/4);if(0!==r){if(1===r)throw"Invalid base64 string.";var o=E[t[e-1]];if(void 0===o)throw"Invalid base64 string.";if(2===r&&0!=(15&o))throw"Invalid base64 string.";if(3===r&&0!=(3&o))throw"Invalid base64 string.";n+=2===r?1:2}for(var i,s,f,u,c=new Uint8Array(n),a=e-r,h=0,p=0,_=0;_<a;_+=4){if(i=E[t[_]],s=E[t[_+1]],f=E[t[_+2]],u=E[t[_+3]],void 0===i||void 0===s||void 0===f||void 0===u)throw"Invalid base64 string.";h=i<<18|s<<12|f<<6|u,c[p++]=h>>>16&255,c[p++]=h>>>8&255,c[p++]=255&h}if(2===r){if(i=E[t[a]],s=E[t[a+1]],void 0===i)throw"Invalid base64 string.";c[p]=i<<2|s>>>4}else if(3===r){if(i=E[t[a]],s=E[t[a+1]],f=E[t[a+2]],void 0===i||void 0===s)throw"Invalid base64 string.";c[p++]=i<<2|s>>>4,c[p]=(15&s)<<4|f>>>2}return c};const{Charmap:m,CharmapType:U}=f,B=h,b=r,C=_,N=g;var F=function(t){if(!t||!t.name)throw"options should provide name property at least";if(m.call(this,t.name,U.CONVERTER),this.description_=t.description,this.version_=t.version,this.segments_=new C.Segments(t.segments),this.mappingBuffer_=null,t.buffer)if(t.buffer instanceof Uint16Array||t.buffer instanceof Uint32Array)this.mappingBuffer_=t.buffer;else if(b.isString(t.buffer)&&t.buffer.startsWith(B.EMBEDDED_BASE64_PREFIX)){var e=t.buffer.substring(B.EMBEDDED_BASE64_PREFIX.length),r=N.decode(e.trim());this.mappingBuffer_=2===t.byte?new Uint16Array(r.buffer):new Uint32Array(r.buffer)}};b.inherits(F,m),F.prototype.description_,F.prototype.version_,F.prototype.segments_,F.prototype.mappingBuffer_,F.prototype.getBytesOfCodepoint=function(){return this.mappingBuffer_?this.mappingBuffer_ instanceof Uint16Array?2:this.mappingBuffer_ instanceof Uint32Array?4:0:0},F.prototype.convert=function(t){if(!t)return null;for(var e=new Uint32Array(t.length),r=0,n=t.length;r<n;++r)e[r]=this.convertChar_(t[r]);return e},F.prototype.convertChar_=function(t){t>>>=0;var e=this.segments_.find(t);if(!e)return B.UNICODE_UNKNOWN_CHAR;switch(e.getReference()){case C.Reference.SELF:return t;case C.Reference.BUFFER:return this.mappingBuffer_?this.mappingBuffer_[t-e.getBegin()+e.getOffset()]:B.UNICODE_UNKNOWN_CHAR;default:return B.UNICODE_UNKNOWN_CHAR}},p.Converter=F;var T={},O={};const{Condition:A}=c,w=r;var D=function(){};D.prototype.decode=function(t,e){var r=this.test(t,e);if(-1===r)return null;for(var n,o=new Uint32Array(r),i=w.isNumber(e)?e:0,s=0,f=t.length;i<f;++s){if(0===(n=this.consume(t,i,o,s)))return null;i+=n}return o},D.prototype.parse=function(t,e){for(var r,n=[],o=w.isNumber(e)?e:0,i=0,s=t.length;o<s;++i){if(0===(r=this.consume_s(t,o,n,i)))return null;o+=r}return n},D.prototype.test=w.abstractMethod,D.prototype.consume=w.abstractMethod,D.prototype.consume_s=w.abstractMethod;var R=function(){D.call(this)};w.inherits(R,D),R.prototype.test=function(t,e){var r=w.isNumber(e)?e:0;if(!t)return-1;if(0===t.length)return 0;var n=t.length-r;if(n<=0)return 0;if(!0&n)return-1;for(var o,i,s,f=0,u=r,c=t.length;u<c;){if(s=0,(o=t[u]|t[u+1]<<8)<=55295||o>=57344?(f+=1,s=2):o>=55296&&o<=56319&&u+3<c&&(i=t[u+2]|t[u+3]<<8)>=56320&&i<=57343&&(f+=1,s=4),!s)return-1;u+=s}return f},R.prototype.consume=function(t,e,r,n){var o=t[e]|t[e+1]<<8,i=2;o>=55296&&o<=56319&&(o=65536+((1023&o)<<10|1023&(t[e+2]|t[e+3]<<8)),i=4);return r[n]=o,i},R.prototype.consume_s=function(t,e,r,n){var o=t.length;if(e+1>=o)return 0;var i=t[e]|t[e+1]<<8,s=2;if(i>=55296&&i<=56319){if(e+3>=o)return 0;var f=t[e+2]|t[e+3]<<8;if(f<56320||f>57343)return 0;i=65536+((1023&i)<<10|1023&f),s=4}return r[n]=i,s};var I=function(){D.call(this)};w.inherits(I,D),I.prototype.test=function(t,e){var r=w.isNumber(e)?e:0;if(!t)return-1;if(0===t.length)return 0;var n=t.length-r;if(n<=0)return 0;if(!0&n)return-1;for(var o,i,s,f=0,u=r,c=t.length;u<c;){if(s=0,(o=t[u]<<8|t[u+1])<=55295||o>=57344?(f+=1,s=2):o>=55296&&o<=56319&&u+3<c&&(i=t[u+2]<<8|t[u+3])>=56320&&i<=57343&&(f+=1,s=4),!s)return-1;u+=s}return f},I.prototype.consume=function(t,e,r,n){var o=t[e]<<8|t[e+1],i=2;o>=55296&&o<=56319&&(o=65536+((1023&o)<<10|1023&(t[e+2]<<8|t[e+3])),i=4);return r[n]=o,i},I.prototype.consume_s=function(t,e,r,n){var o=t.length;if(e+1>=o)return 0;var i=t[e]<<8|t[e+1],s=2;if(i>=55296&&i<=56319){if(e+3>=o)return 0;var f=t[e+2]<<8|t[e+3];if(f<56320||f>57343)return 0;i=65536+((1023&i)<<10|1023&f),s=4}return r[n]=i,s};var M=function(){D.call(this)};w.inherits(M,D),M.prototype.test=function(t,e){var r=w.isNumber(e)?e:0;if(!t)return-1;if(0===t.length||t.length-r<=0)return 0;for(var n=0,o=r,i=t.length;o<i;)if(0==(128&t[o]))o++,n++;else if(o+1<i&&192==(224&t[o])&&128==(192&t[o+1]))o+=2,n++;else if(o+2<i&&224==(240&t[o])&&128==(192&t[o+1])&&128==(192&t[o+2]))o+=3,n++;else if(o+3<i&&240==(248&t[o])&&128==(192&t[o+1])&&128==(192&t[o+2])&&128==(192&t[o+3]))o+=4,n++;else if(o+4<i&&248==(252&t[o])&&128==(192&t[o+1])&&128==(192&t[o+2])&&128==(192&t[o+3])&&128==(192&t[o+4]))o+=5,n++;else{if(!(o+5<i&&252==(254&t[o])&&128==(192&t[o+1])&&128==(192&t[o+2])&&128==(192&t[o+3])&&128==(192&t[o+4])&&128==(192&t[o+5])))return-1;o+=6,n++}return n},M.prototype.consume=function(t,e,r,n){return 0==(128&t[e])?(r[n]=t[e],1):192==(224&t[e])?(r[n]=(63&t[e])<<6|63&t[e+1],2):224==(240&t[e])?(r[n]=(31&t[e])<<12|(63&t[e+1])<<6|63&t[e+2],3):240==(248&t[e])?(r[n]=(15&t[e])<<18|(63&t[e+1])<<12|(63&t[e+2])<<6|63&t[e+3],4):248==(252&t[e])?(r[n]=(7&t[e])<<24|(63&t[e+1])<<18|(63&t[e+2])<<12|(63&t[e+3])<<6|63&t[e+4],5):252==(254&t[e])?(r[n]=(3&t[e])<<30|(63&t[e+1])<<24|(63&t[e+2])<<18|(63&t[e+3])<<12|(63&t[e+4])<<6|63&t[e+5],6):0},M.prototype.consume_s=function(t,e,r,n){var o=t.length;return 0==(128&t[e])?(r[n]=t[e],1):e+1<o&&192==(224&t[e])&&128==(192&t[e+1])?(r[n]=(63&t[e])<<6|63&t[e+1],2):e+2<o&&224==(240&t[e])&&128==(192&t[e+1])&&128==(192&t[e+2])?(r[n]=(31&t[e])<<12|(63&t[e+1])<<6|63&t[e+2],3):e+3<o&&240==(248&t[e])&&128==(192&t[e+1])&&128==(192&t[e+2])&&128==(192&t[e+3])?(r[n]=(15&t[e])<<18|(63&t[e+1])<<12|(63&t[e+2])<<6|63&t[e+3],4):e+4<o&&248==(252&t[e])&&128==(192&t[e+1])&&128==(192&t[e+2])&&128==(192&t[e+3])&&128==(192&t[e+4])?(r[n]=(7&t[e])<<24|(63&t[e+1])<<18|(63&t[e+2])<<12|(63&t[e+3])<<6|63&t[e+4],5):e+5<o&&252==(254&t[e])&&128==(192&t[e+1])&&128==(192&t[e+2])&&128==(192&t[e+3])&&128==(192&t[e+4])&&128==(192&t[e+5])?(r[n]=(3&t[e])<<30|(63&t[e+1])<<24|(63&t[e+2])<<18|(63&t[e+3])<<12|(63&t[e+4])<<6|63&t[e+5],6):0};var S=function(t){D.call(this),this.conditions_=[],t&&w.isArray(t)&&t.forEach((function(t){var e=A.build(t.condition);e&&this.conditions_.push(e)}),this)};w.inherits(S,D),S.prototype.conditions_,S.prototype.test=function(t,e){var r=w.isNumber(e)?e:0;if(!this.conditions_.length||!t)return-1;if(0===t.length||t.length-r<=0)return 0;for(var n,o=0,i=r,s=t.length;i<s;){if(!(n=this.find_(t,i)))return-1;i+=n.getBytes(),o++}return o},S.prototype.find_=function(t,e){for(var r=0,n=this.conditions_.length;r<n;++r)if(this.conditions_[r].consume(t,e))return this.conditions_[r];return null},S.prototype.consume=function(t,e,r,n){var o=this.find_(t,e);if(!o)return 0;var i=o.getBytes();return r[n]=this.readUInt32BE_(t,e,i),i},S.prototype.readUInt32BE_=function(t,e,r){for(var n=0,o=0;o<r;++o)n|=t[e+o]<<8*(r-1-o);return n>>>0},S.prototype.consume_s=S.prototype.consume,O.Multibyte=S,O.UTF16LE=new R,O.UTF16BE=new I,O.UTF8=new M;var P={};const{Condition:x}=c,L=h;var k=x.build(["0x90~0xE3","0x30~0x39","0x81~0xFE","0x30~0x39"]);P.convertGB18030ToUnicodeSP=function(t){if(t<2419097904||t>3811744309)return L.UNICODE_UNKNOWN_CHAR;var e=k.getIndexingOffset(t);return-1===e||e>1048575?L.UNICODE_UNKNOWN_CHAR:e+65536},P.convertUnicodeSPToGB18030=function(t){if(t<65536||t>1114111)return L.MBCS_WHITE_SPACE.GB18030;var e=t-65536;return k.getCodePoint(e)};const{Charmap:W,CharmapType:K}=f,j=h,G=O,H=P,X=r,Y=_,$=g;var V=function(t){W.call(this,t,K.DECODER)};X.inherits(V,W),V.prototype.rule_,V.prototype.match=X.abstractMethod,V.prototype.decode=X.abstractMethod;var z=function(){V.call(this,"UTF-16LE"),this.rule_=G.UTF16LE};X.inherits(z,V),z.prototype.match=function(t,e){return-1!==this.rule_.test(t,e)},z.prototype.hasBom=function(t){return t&&t.length>=2&&t[0]===j.UTF16LE_BOM[0]&&t[1]===j.UTF16LE_BOM[1]},z.prototype.decode=function(t,e){return this.rule_.decode(t,e)};var q=function(){V.call(this,"UTF-16BE"),this.rule_=G.UTF16BE};X.inherits(q,V),q.prototype.match=function(t,e){return-1!==this.rule_.test(t,e)},q.prototype.hasBom=function(t){return t&&t.length>=2&&t[0]===j.UTF16BE_BOM[0]&&t[1]===j.UTF16BE_BOM[1]},q.prototype.decode=function(t,e){return this.rule_.decode(t,e)};var J=function(){V.call(this,"UTF-8"),this.rule_=G.UTF8};X.inherits(J,V),J.prototype.match=function(t,e){return-1!==this.rule_.test(t,e)},J.prototype.hasBom=function(t){return t&&t.length>=3&&t[0]===j.UTF8_BOM[0]&&t[1]===j.UTF8_BOM[1]&&t[2]===j.UTF8_BOM[2]},J.prototype.decode=function(t,e){return this.rule_.decode(t,e)};var Q=function(t){if(!t||!t.name)throw"options should provide name property at least";if(V.call(this,t.name),this.description_=t.description,this.version_=t.version,this.rule_=new G.Multibyte(t.rules),this.segments_=new Y.Segments(t.segments),this.mappingBuffer_=null,t.buffer)if(t.buffer instanceof Uint16Array||t.buffer instanceof Uint32Array)this.mappingBuffer_=t.buffer;else if(X.isString(t.buffer)&&t.buffer.startsWith(j.EMBEDDED_BASE64_PREFIX)){var e=t.buffer.substring(j.EMBEDDED_BASE64_PREFIX.length),r=$.decode(e.trim());this.mappingBuffer_=2===t.byte?new Uint16Array(r.buffer):new Uint32Array(r.buffer)}};X.inherits(Q,V),Q.prototype.mappingBuffer_,Q.prototype.segments_,Q.prototype.getBytesOfCodepoint=function(){return this.mappingBuffer_?this.mappingBuffer_ instanceof Uint16Array?2:this.mappingBuffer_ instanceof Uint32Array?4:0:0},Q.prototype.match=function(t,e){var r=this.rule_.decode(t,e);if(!r)return!1;for(var n=0,o=r.length;n<o;++n)if(this.convertChar_(r[n])===j.UNICODE_UNKNOWN_CHAR)return!1;return!0},Q.prototype.decode=function(t,e){var r=this.rule_.decode(t,e);if(!r)return null;for(var n=new Uint32Array(r.length),o=0,i=r.length;o<i;++o)n[o]=this.convertChar_(r[o]);return n},Q.prototype.convertChar_=function(t){t>>>=0;var e=this.segments_.find(t);if(!e)return j.UNICODE_UNKNOWN_CHAR;switch(e.getReference()){case Y.Reference.ASCII:return 127&t;case Y.Reference.UNDEFINED:return j.UNICODE_UNKNOWN_CHAR;case Y.Reference.BUFFER:return this.mappingBuffer_?this.mappingBuffer_[t-e.getBegin()+e.getOffset()]:j.UNICODE_UNKNOWN_CHAR;case Y.Reference.INDEXING_BUFFER:if(!this.mappingBuffer_)return j.UNICODE_UNKNOWN_CHAR;var r=this.getIndexingBufferOffset_(e,t);return-1===r?j.UNICODE_UNKNOWN_CHAR:this.mappingBuffer_[r+e.getOffset()];case Y.Reference.SELF:return t;case Y.Reference.GB18030_UNICODE_SP_MAPPING:return H.convertGB18030ToUnicodeSP(t);default:return j.UNICODE_UNKNOWN_CHAR}},Q.prototype.getIndexingBufferOffset_=function(t,e){var r=t.getCondition();return r?r.getIndexingOffset(e):-1},T.UTF16LE=new z,T.UTF16BE=new q,T.UTF8=new J,T.Decoder=V,T.Multibyte=Q;var Z={},tt={};const et=r,rt=h,nt=_,ot=P,it=t,st=g;var ft=function(){};ft.prototype.encode=function(t){var e=this.test(t);if(-1===e)return null;for(var r=new Uint8Array(e),n=0,o=0,i=t.length;o<i;++o)n+=this.consume(t,o,r,n);return r},ft.prototype.test=et.abstractMethod,ft.prototype.consume=et.abstractMethod;var ut=function(){ft.call(this)};et.inherits(ut,ft),ut.prototype.test=function(t){if(!t)return-1;if(0===t.length)return 0;for(var e,r=0,n=0,o=t.length;n<o;++n)(e=t[n]>>>0)<=55295?r+=2:e>=55296&&e<=57343||(e>=57344&&e<=65535?r+=2:e>=65536&&e<=1114111&&(r+=4));return r},ut.prototype.consume=function(t,e,r,n){var o,i=t[e]>>>0;if(i<=55295||i>=57344&&i<=65535)r[n]=255&i,r[n+1]=i>>8,o=2;else if(i>=55296&&i<=57343)o=0;else if(i>=65536&&i<=1114111){var s=56320+(1023&(i-=65536)),f=55296+(i>>10);r[n]=255&f,r[n+1]=f>>8,r[n+2]=255&s,r[n+3]=s>>8,o=4}else o=0;return o};var ct=function(){ft.call(this)};et.inherits(ct,ft),ct.prototype.test=function(t){if(!t)return-1;if(0===t.length)return 0;for(var e,r=0,n=0,o=t.length;n<o;++n)(e=t[n]>>>0)<=55295?r+=2:e>=55296&&e<=57343||(e>=57344&&e<=65535?r+=2:e>=65536&&e<=1114111&&(r+=4));return r},ct.prototype.consume=function(t,e,r,n){var o,i=t[e]>>>0;if(i<=55295||i>=57344&&i<=65535)r[n]=i>>8,r[n+1]=255&i,o=2;else if(i>=55296&&i<=57343)o=0;else if(i>=65536&&i<=1114111){var s=56320+(1023&(i-=65536)),f=55296+(i>>10);r[n]=f>>8,r[n+1]=255&f,r[n+2]=s>>8,r[n+3]=255&s,o=4}else o=0;return o};var at=function(){ft.call(this)};et.inherits(at,ft),at.prototype.test=function(t){if(!t)return-1;if(0===t.length)return 0;for(var e,r=0,n=0,o=t.length;n<o;++n)(e=t[n]>>>0)<=127?r+=1:e<=2047?r+=2:e<=55295?r+=3:e<=57343||(e<=65535?r+=3:e<=1114111&&(r+=4));return r},at.prototype.consume=function(t,e,r,n){var o,i=t[e]>>>0;return i<=127?(r[n]=i,o=1):i<=2047?(r[n]=192|i>>6,r[n+1]=128|63&i,o=2):i>=55296&&i<=57343?o=0:i<=65535?(r[n]=224|i>>12,r[n+1]=128|i>>6&63,r[n+2]=128|63&i,o=3):i<=1114111?(r[n]=240|i>>18,r[n+1]=128|i>>12&63,r[n+2]=128|i>>6&63,r[n+3]=128|63&i,o=4):o=0,o};var ht=function(t,e,r,n){if(ft.call(this),this.segments_=new nt.Segments(t),this.mappingBuffer_=null,e)if(e instanceof Uint16Array||e instanceof Uint32Array)this.mappingBuffer_=e;else if(et.isString(e)&&e.startsWith(rt.EMBEDDED_BASE64_PREFIX)){var o=e.substring(rt.EMBEDDED_BASE64_PREFIX.length),i=st.decode(o.trim());this.mappingBuffer_=2===r?new Uint16Array(i.buffer):new Uint32Array(i.buffer)}this.unknownChar_=n||63,this.unknownCharBytes_=this.getCharBytes_(this.unknownChar_)};et.inherits(ht,ft),ht.prototype.segments_,ht.prototype.mappingBuffer_,ht.prototype.unknownChar_,ht.prototype.getBytesOfCodepoint=function(){return this.mappingBuffer_?this.mappingBuffer_ instanceof Uint16Array?2:this.mappingBuffer_ instanceof Uint32Array?4:0:0},ht.prototype.test=function(t){if(!t)return-1;var e=t.length;if(0===e)return 0;for(var r,n,o=0,i=0;i<e;++i)if(r=t[i]>>>0,n=this.segments_.find(r))switch(n.getReference()){case nt.Reference.ASCII:o+=1;break;case nt.Reference.BUFFER:this.mappingBuffer_?o+=this.getCharBytes_(this.mappingBuffer_[r-n.getBegin()+n.getOffset()]):o+=this.unknownCharBytes_;break;case nt.Reference.GB18030_UNICODE_SP_MAPPING:o+=4}else o+=this.unknownCharBytes_;return o},ht.prototype.getCharBytes_=function(t){return(t>>>=0)<=255?1:t<=65535?2:4},ht.prototype.consume=function(t,e,r,n){var o,i=0,s=t[e]>>>0,f=this.segments_.find(s);if(!f)return it.writeUInt32BE(r,n,this.unknownChar_,this.unknownCharBytes_),this.unknownCharBytes_;switch(f.getReference()){case nt.Reference.ASCII:r[n]=s,i=1;break;case nt.Reference.BUFFER:if(!this.mappingBuffer_)return it.writeUInt32BE(r,n,this.unknownChar_,this.unknownCharBytes_),this.unknownCharBytes_;o=this.mappingBuffer_[s-f.getBegin()+f.getOffset()],i=this.getCharBytes_(o),it.writeUInt32BE(r,n,o,i);break;case nt.Reference.GB18030_UNICODE_SP_MAPPING:o=ot.convertUnicodeSPToGB18030(s),i=4,it.writeUInt32BE(r,n,o,i)}return i},tt.UTF16LE=new ut,tt.UTF16BE=new ct,tt.UTF8=new at,tt.Multibyte=ht;const{Charmap:pt,CharmapType:_t}=f,dt=h,lt=tt,yt=r;var gt=function(t){pt.call(this,t,_t.ENCODER)};yt.inherits(gt,pt),gt.prototype.rule_,gt.prototype.encode=yt.abstractMethod;var vt=function(){gt.call(this,"UTF-16LE"),this.rule_=lt.UTF16LE};yt.inherits(vt,gt),vt.prototype.encode=function(t){return this.rule_.encode(t)};var Et=function(){gt.call(this,"UTF-16BE"),this.rule_=lt.UTF16BE};yt.inherits(Et,gt),Et.prototype.encode=function(t){return this.rule_.encode(t)};var mt=function(){gt.call(this,"UTF-8"),this.rule_=lt.UTF8};yt.inherits(mt,gt),mt.prototype.encode=function(t){return this.rule_.encode(t)};var Ut=function(t){if(!t||!t.name)throw"options should provide name property at least";gt.call(this,t.name),this.description_=t.description,this.version_=t.version,this.rule_=new lt.Multibyte(t.segments,t.buffer,t.byte,dt.MBCS_UNKNOWN_CHAR)};yt.inherits(Ut,gt),Ut.prototype.getBytesOfCodepoint=function(){return this.rule_.getBytesOfCodepoint()},Ut.prototype.encode=function(t){return this.rule_.encode(t)},Z.UTF16LE=new vt,Z.UTF16BE=new Et,Z.UTF8=new mt,Z.Encoder=gt,Z.Multibyte=Ut;var Bt={};const bt=h,Ct=t,{Channel:Nt}=e,{Converter:Ft}=p,Tt=T,Ot=Z,At=r;var wt=function(t){this.reload(t)};wt.prototype.encoders_,wt.prototype.decoders_,wt.prototype.converters_,wt.prototype.channels_,wt.prototype.detectionOrder_,wt.prototype.reload=function(t){this.decoders_={},this.decoders_[Tt.UTF8.getName()]=Tt.UTF8,this.decoders_[Tt.UTF16LE.getName()]=Tt.UTF16LE,this.decoders_[Tt.UTF16BE.getName()]=Tt.UTF16BE,this.encoders_={},this.encoders_[Ot.UTF8.getName()]=Ot.UTF8,this.encoders_[Ot.UTF16LE.getName()]=Ot.UTF16LE,this.encoders_[Ot.UTF16BE.getName()]=Ot.UTF16BE,this.converters_={},this.detectionOrder_=[],this.channels_={},t&&(At.isArray(t.decoders)&&t.decoders.forEach((t=>{var e=new Tt.Multibyte(t);this.decoders_[e.getName()]=e}),this),At.isArray(t.detection_order)&&(this.detectionOrder_=t.detection_order.slice()),At.isArray(t.encoders)&&t.encoders.forEach((t=>{var e=new Ot.Multibyte(t);this.encoders_[e.getName()]=e}),this),At.isArray(t.converters)&&t.converters.forEach((t=>{var e=new Ft(t);this.converters_[e.getName()]=e}),this),At.isArray(t.channels)&&t.channels.forEach((t=>{this.newChannel(t.name,t.decoder,t.encoder,t.converters)}),this))},wt.prototype.getDecoder=function(t){return this.decoders_[t]},wt.prototype.getDecoderNames=function(){return Object.keys(this.decoders_)},wt.prototype.getEncoder=function(t){return this.encoders_[t]},wt.prototype.getEncoderNames=function(){return Object.keys(this.encoders_)},wt.prototype.getConverter=function(t){return this.converters_[t]},wt.prototype.getConverterNames=function(){return Object.keys(this.converters_)},wt.prototype.getChannel=function(t){return this.channels_[t]},wt.prototype.getChannelNames=function(){return Object.keys(this.channels_)},wt.prototype.newChannel=function(t,e,r,n){if(!this.decoders_[e]||!this.encoders_[r])return null;var o=[];return n&&(At.isString(n)?this.converters_[n]&&o.push(this.converters_[n]):At.isArray(n)&&n.forEach((t=>{this.converters_[t]&&o.push(this.converters_[t])}),this)),this.channels_[t]=new Nt(this.decoders_[e],this.encoders_[r],o)},wt.prototype.decode=function(t,e,r){var n=this.getDecoder(e);if(!n)throw`Error: decoder ${e} not found in the context.`;return n.decode(t,r)},wt.prototype.encode=function(t,e){var r=this.getEncoder(e);if(!r)throw`Error: encoder ${e} not found in the context.`;return r.encode(t)},wt.prototype.decodeAsString=function(t,e,r){var n=this.getDecoder(e);if(!n)throw`Error: decoder ${e} not found in the context.`;var o=Ct.toString(n.decode(t,r));return o&&o.codePointAt(0)===bt.UNICODE_BYTE_ORDER_MARK?o.substring(1):o},wt.prototype.encodeFromString=function(t,e,r){var n=this.getEncoder(e);if(!n)throw`Error: encoder ${e} not found in the context.`;if(!At.isString(t))throw"Error: invalid type for str.";return!r||n!==Ot.UTF8&&n!==Ot.UTF16LE&&n!==Ot.UTF16BE||t.codePointAt(0)!==bt.UNICODE_BYTE_ORDER_MARK&&(t=String.fromCodePoint(bt.UNICODE_BYTE_ORDER_MARK)+t),n.encode(Ct.toBuffer(t))},wt.prototype.findPossibleEncoding=function(t){if(Tt.UTF8.match(t))return{encoding:Tt.UTF8.getName(),hasBom:Tt.UTF8.hasBom(t)};if(Tt.UTF16LE.hasBom(t)&&Tt.UTF16LE.match(t))return{encoding:Tt.UTF16LE.getName(),hasBom:!0};if(Tt.UTF16BE.hasBom(t)&&Tt.UTF16BE.match(t))return{encoding:Tt.UTF16BE.getName(),hasBom:!0};var e=this.detectionOrder_.find((e=>{var r=this.getDecoder(e);return r&&r.match(t)}),this);return e?{encoding:e,hasBom:!1}:null},Bt.Context=wt;var Dt={};const{Context:Rt}=Bt,It=r,Mt=h;Dt.loadFromUrl=function(t){var e=fetch(t).then((t=>t.json())),r=function(t){return It.isString(t.buffer)&&!t.buffer.startsWith(Mt.EMBEDDED_BASE64_PREFIX)?fetch(t.buffer).then((t=>t.arrayBuffer())).then((e=>{t.buffer=2===t.byte?new Uint16Array(e):new Uint32Array(e)})):Promise.resolve()};return(e=e.then((t=>{var e=[];return It.isArray(t.decoders)&&t.decoders.forEach((t=>{e.push(r(t))})),It.isArray(t.encoders)&&t.encoders.forEach((t=>{e.push(r(t))})),It.isArray(t.converters)&&t.converters.forEach((t=>{e.push(r(t))})),Promise.all(e).then((()=>t))}))).then((t=>new Rt(t)))};const St=t,{Channel:Pt}=e,{CharmapType:xt}=f,{Condition:Lt}=c,kt=h,{Converter:Wt}=p,Kt=T,jt=Z,{Reference:Gt}=_,{Context:Ht}=Bt,Xt=g,{loadFromUrl:Yt}=Dt;return{Converter:Wt,DecoderMultibyte:Kt.Multibyte,DECODER_UTF8:Kt.UTF8,DECODER_UTF16LE:Kt.UTF16LE,DECODER_UTF16BE:Kt.UTF16BE,EncoderMultibyte:jt.Multibyte,ENCODER_UTF8:jt.UTF8,ENCODER_UTF16LE:jt.UTF16LE,ENCODER_UTF16BE:jt.UTF16BE,Channel:Pt,Condition:Lt,CharmapType:xt,SegmentReference:Gt,Context:Ht,Consts:kt,utils:St,base64:Xt,loadFromUrl:Yt}}));
