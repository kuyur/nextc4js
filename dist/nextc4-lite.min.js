!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).nextc4=e()}(this,(function(){"use strict";var t={readUInt32BE:function(t,e,r){if(e+(r=Math.min(r,4))>t.length)throw"Error: exceed the buffer boundary.";for(var n=0,o=0;o<r;++o)n|=t[e+o]<<8*(r-1-o);return n>>>0},writeUInt32BE:function(t,e,r,n){if(e+(n=Math.min(n,4))>t.length)throw"Error: exceed the buffer boundary.";for(var o=n-1;o>=0;o--)t[e+o]=255&r,r>>>=8},toString:function(t){if(!t)return null;for(var e=[],r=0,n=t.length;r<n;++r)e[r]=String.fromCodePoint(t[r]);return e.join("")},toBuffer:function(t){if(!t)return null;for(var e=t.length,r=new Uint32Array(e),n=0,o=0;o<e;++o){var i=t.codePointAt(o);r[n++]=i,i>65535&&o++}return r.slice(0,n)}},e={},r={},n={},o=function(t){var e=typeof t;if("object"===e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var r=Object.prototype.toString.call(t);if("[object Window]"===r)return"object";if("[object Array]"===r||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"===r||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"===e&&void 0===t.call)return"object";return e},i=function(t){var e=typeof t;return"object"===e&&null!=t||"function"===e};n.abstractMethod=function(){throw Error("unimplemented abstract method")},n.nullFunction=function(){},n.inherits=function(t,e){function r(){}r.prototype=e.prototype,t.super_=e.prototype,t.prototype=new r,t.prototype.constructor=t},n.typeOf=o,n.isNull=function(t){return null===t},n.isDefAndNotNull=function(t){return null!=t},n.isArray=function(t){return"array"===o(t)},n.isArrayLike=function(t){var e=o(t);return"array"===e||"object"===e&&"number"==typeof t.length},n.isDateLike=function(t){return i(t)&&"function"==typeof t.getFullYear},n.isString=function(t){return"string"==typeof t},n.isBoolean=function(t){return"boolean"==typeof t},n.isNumber=function(t){return"number"==typeof t},n.isFunction=function(t){return"function"===o(t)},n.isObject=i;var s={},u={},f=function(t){this.bytes_=t.length,this.ranges_=t};f.prototype.bytes_,f.prototype.ranges_,f.prototype.getBytes=function(){return this.bytes_},f.prototype.match=function(t){if(!this.bytes_)return!1;for(var e,r=this.bytes_-1;r>=0;--r){if((e=255&t)<this.ranges_[r].from||e>this.ranges_[r].to)return!1;t>>=8}return!0},f.prototype.getBlockSize=function(){if(!this.bytes_)return 0;var t=this.ranges_[this.bytes_-1];return t.to-t.from+1},f.prototype.getBlockCount=function(){if(!this.bytes_)return 0;for(var t=1,e=0;e<this.bytes_-1;++e)t*=this.ranges_[e].to-this.ranges_[e].from+1;return t},f.prototype.getIndexingOffset=function(t){if(!this.bytes_)return-1;for(var e,r=this.getCarries_(),n=0,o=this.bytes_-1;o>=0;--o){if((e=255&t)<this.ranges_[o].from||e>this.ranges_[o].to)return-1;n+=(e-this.ranges_[o].from)*r[o],t>>=8}return n},f.prototype.getCodePoint=function(t){if(!this.bytes_)return-1;for(var e=this.getCarries_(),r=0,n=0;n<this.bytes_;++n)t>=e[n]?(r|=Math.floor(t/e[n])+this.ranges_[n].from<<8*(this.bytes_-1-n),t%=e[n]):r|=this.ranges_[n].from<<8*(this.bytes_-1-n);return r>>>0},f.prototype.getCarries_=function(){if(!this.carries_){this.carries_=[],this.carries_[this.bytes_-1]=1;for(var t=this.bytes_-2;t>=0;--t)this.carries_[t]=this.carries_[t+1]*(this.ranges_[t+1].to-this.ranges_[t+1].from+1)}return this.carries_},f.prototype.consume=function(t,e){if(!this.bytes_)return!1;if(e+this.bytes_>t.length)return!1;for(var r=0;r<this.bytes_;++r)if(t[e+r]<this.ranges_[r].from||t[e+r]>this.ranges_[r].to)return!1;return!0},f.build=function(t){if(!t||!t.length)return null;var e=[];return t.forEach((function(t){var r=t.split("~");if(1===r.length){var n=+r[0];isNaN(n)||e.push({from:n,to:n})}else if(2===r.length){var o=+r[0],i=+r[1];!isNaN(o)&&!isNaN(i)&&o>=0&&o<=255&&i>=0&&i<=255&&e.push({from:Math.min(o,i),to:Math.max(o,i)})}})),e.length?new f(e):null},u.Condition=f;const{Condition:a}=u;var c=function(t){this.begin_=t.begin,this.end_=t.end,this.condition_=a.build(t.condition),this.reference_=t.reference,this.offset_=t.offset,this.characterset_=t.characterset};c.prototype.begin_,c.prototype.end_,c.prototype.condition_,c.prototype.reference_,c.prototype.offset_,c.prototype.characterset_,c.prototype.getBegin=function(){return this.begin_},c.prototype.getEnd=function(){return this.end_},c.prototype.getOffset=function(){return this.offset_},c.prototype.getReference=function(){return this.reference_},c.prototype.getCondition=function(){return this.condition_};var h=function(t){this.segments_=[],t&&t.forEach((function(t){t instanceof c||(t=new c(t)),this.segments_.push(t)}),this)};h.prototype.segments_,h.prototype.find=function(t){for(var e=0,r=this.segments_.length;e<r;++e)if(t>=this.segments_[e].begin_&&t<=this.segments_[e].end_&&(!this.segments_[e].condition_||this.segments_[e].condition_.match(t)))return this.segments_[e];return null},s.Reference={ASCII:"ascii",UNDEFINED:"undefined",BUFFER:"buffer",INDEXING_BUFFER:"indexing-buffer",SELF:"self",GB18030_UNICODE_SP_MAPPING:"gb18030-unicode-sp-mapping"},s.Segment=c,s.Segments=h;var p={},_={UNICODE_UNKNOWN_CHAR:65533,UNICODE_BYTE_ORDER_MARK:65279};_.UTF8_BOM=new Uint8Array([239,187,191]),_.UTF16LE_BOM=new Uint8Array([255,254]),_.UTF16BE_BOM=new Uint8Array([254,255]),_.MBCS_UNKNOWN_CHAR=63,_.MBCS_WHITE_SPACE={GBK:41377,GB18030:41377},_.EMBEDDED_BASE64_PREFIX="data:application/octet-stream;base64,";const{Condition:d}=u,l=_;var y=d.build(["0x90~0xE3","0x30~0x39","0x81~0xFE","0x30~0x39"]);p.convertGB18030ToUnicodeSP=function(t){if(t<2419097904||t>3811744309)return l.UNICODE_UNKNOWN_CHAR;var e=y.getIndexingOffset(t);return-1===e||e>1048575?l.UNICODE_UNKNOWN_CHAR:e+65536},p.convertUnicodeSPToGB18030=function(t){if(t<65536||t>1114111)return l.MBCS_WHITE_SPACE.GB18030;var e=t-65536;return y.getCodePoint(e)};const g=n,E=s,v=p,m=t;var B=function(){};B.prototype.encode=function(t){var e=this.test(t);if(-1===e)return null;for(var r=new Uint8Array(e),n=0,o=0,i=t.length;o<i;++o)n+=this.consume(t,o,r,n);return r},B.prototype.unparse=function(t,e){var r=this.tell(t);if(-1===r)return null;for(var n=e?[]:new Uint8Array(r),o=0,i=0,s=t.length;i<s;++i){var u=t.codePointAt(i);o+=this.write(u,n,o),u>65535&&i++}return n},B.prototype.test=g.abstractMethod,B.prototype.consume=g.abstractMethod,B.prototype.tell=g.abstractMethod,B.prototype.write=g.abstractMethod;var U=function(){B.call(this)};g.inherits(U,B),U.prototype.test=function(t){if(!g.isArrayLike(t))return-1;if(0===t.length)return 0;for(var e,r=0,n=0,o=t.length;n<o;++n)(e=t[n]>>>0)<=55295?r+=2:e>=55296&&e<=57343||(e>=57344&&e<=65535?r+=2:e>=65536&&e<=1114111&&(r+=4));return r},U.prototype.consume=function(t,e,r,n){var o,i=t[e]>>>0;if(i<=55295||i>=57344&&i<=65535)r[n]=255&i,r[n+1]=i>>8,o=2;else if(i>=55296&&i<=57343)o=0;else if(i>=65536&&i<=1114111){var s=56320+(1023&(i-=65536)),u=55296+(i>>10);r[n]=255&u,r[n+1]=u>>8,r[n+2]=255&s,r[n+3]=s>>8,o=4}else o=0;return o},U.prototype.tell=function(t){return g.isString(t)?2*t.length:-1},U.prototype.write=function(t,e,r){var n;if(t<=55295||t>=57344&&t<=65535)e[r]=255&t,e[r+1]=t>>8,n=2;else if(t>=55296&&t<=57343)n=0;else if(t>=65536&&t<=1114111){var o=56320+(1023&(t-=65536)),i=55296+(t>>10);e[r]=255&i,e[r+1]=i>>8,e[r+2]=255&o,e[r+3]=o>>8,n=4}else n=0;return n};var C=function(){B.call(this)};g.inherits(C,B),C.prototype.test=function(t){if(!g.isArrayLike(t))return-1;if(0===t.length)return 0;for(var e,r=0,n=0,o=t.length;n<o;++n)(e=t[n]>>>0)<=55295?r+=2:e>=55296&&e<=57343||(e>=57344&&e<=65535?r+=2:e>=65536&&e<=1114111&&(r+=4));return r},C.prototype.consume=function(t,e,r,n){var o,i=t[e]>>>0;if(i<=55295||i>=57344&&i<=65535)r[n]=i>>8,r[n+1]=255&i,o=2;else if(i>=55296&&i<=57343)o=0;else if(i>=65536&&i<=1114111){var s=56320+(1023&(i-=65536)),u=55296+(i>>10);r[n]=u>>8,r[n+1]=255&u,r[n+2]=s>>8,r[n+3]=255&s,o=4}else o=0;return o},C.prototype.tell=function(t){return g.isString(t)?2*t.length:-1},C.prototype.write=function(t,e,r){var n;if(t<=55295||t>=57344&&t<=65535)e[r]=t>>8,e[r+1]=255&t,n=2;else if(t>=55296&&t<=57343)n=0;else if(t>=65536&&t<=1114111){var o=56320+(1023&(t-=65536)),i=55296+(t>>10);e[r]=i>>8,e[r+1]=255&i,e[r+2]=o>>8,e[r+3]=255&o,n=4}else n=0;return n};var b=function(){B.call(this)};g.inherits(b,B),b.prototype.test=function(t){if(!g.isArrayLike(t))return-1;if(0===t.length)return 0;for(var e,r=0,n=0,o=t.length;n<o;++n)(e=t[n]>>>0)<=127?r+=1:e<=2047?r+=2:e<=55295?r+=3:e<=57343||(e<=65535?r+=3:e<=1114111&&(r+=4));return r},b.prototype.consume=function(t,e,r,n){var o,i=t[e]>>>0;return i<=127?(r[n]=i,o=1):i<=2047?(r[n]=192|i>>6,r[n+1]=128|63&i,o=2):i>=55296&&i<=57343?o=0:i<=65535?(r[n]=224|i>>12,r[n+1]=128|i>>6&63,r[n+2]=128|63&i,o=3):i<=1114111?(r[n]=240|i>>18,r[n+1]=128|i>>12&63,r[n+2]=128|i>>6&63,r[n+3]=128|63&i,o=4):o=0,o},b.prototype.tell=function(t){if(!g.isString(t))return-1;for(var e,r=0,n=0,o=t.length;n<o;++n)(e=t.codePointAt(n))<=127?r+=1:e<=2047?r+=2:e<=55295?r+=3:e<=57343||(e<=65535?r+=3:e<=1114111&&(r+=4)),e>65535&&n++;return r},b.prototype.write=function(t,e,r){var n;return t<=127?(e[r]=t,n=1):t<=2047?(e[r]=192|t>>6,e[r+1]=128|63&t,n=2):t>=55296&&t<=57343?n=0:t<=65535?(e[r]=224|t>>12,e[r+1]=128|t>>6&63,e[r+2]=128|63&t,n=3):t<=1114111?(e[r]=240|t>>18,e[r+1]=128|t>>12&63,e[r+2]=128|t>>6&63,e[r+3]=128|63&t,n=4):n=0,n};var N=function(t,e,r){B.call(this),this.segments_=new E.Segments(t),this.mappingBuffer_=e,this.unknownChar_=r||63,this.unknownCharBytes_=this.getCharBytes_(this.unknownChar_)};g.inherits(N,B),N.prototype.segments_,N.prototype.mappingBuffer_,N.prototype.unknownChar_,N.prototype.getBytesOfCodepoint=function(){return this.mappingBuffer_?this.mappingBuffer_ instanceof Uint16Array?2:this.mappingBuffer_ instanceof Uint32Array?4:0:0},N.prototype.test=function(t){if(!g.isArrayLike(t))return-1;var e=t.length;if(0===e)return 0;for(var r,n,o=0,i=0;i<e;++i)if(r=t[i]>>>0,n=this.segments_.find(r))switch(n.getReference()){case E.Reference.ASCII:o+=1;break;case E.Reference.BUFFER:this.mappingBuffer_?o+=this.getCharBytes_(this.mappingBuffer_[r-n.getBegin()+n.getOffset()]):o+=this.unknownCharBytes_;break;case E.Reference.GB18030_UNICODE_SP_MAPPING:o+=4}else o+=this.unknownCharBytes_;return o},N.prototype.getCharBytes_=function(t){return(t>>>=0)<=255?1:t<=65535?2:4},N.prototype.consume=function(t,e,r,n){var o,i=0,s=t[e]>>>0,u=this.segments_.find(s);if(!u)return m.writeUInt32BE(r,n,this.unknownChar_,this.unknownCharBytes_),this.unknownCharBytes_;switch(u.getReference()){case E.Reference.ASCII:r[n]=s,i=1;break;case E.Reference.BUFFER:if(!this.mappingBuffer_)return m.writeUInt32BE(r,n,this.unknownChar_,this.unknownCharBytes_),this.unknownCharBytes_;o=this.mappingBuffer_[s-u.getBegin()+u.getOffset()],i=this.getCharBytes_(o),m.writeUInt32BE(r,n,o,i);break;case E.Reference.GB18030_UNICODE_SP_MAPPING:o=v.convertUnicodeSPToGB18030(s),i=4,m.writeUInt32BE(r,n,o,i)}return i},N.prototype.tell=function(t){if(!g.isString(t))return-1;for(var e,r,n=0,o=0,i=t.length;o<i;++o)if((e=t.codePointAt(o))>65535&&o++,r=this.segments_.find(e))switch(r.getReference()){case E.Reference.ASCII:n+=1;break;case E.Reference.BUFFER:this.mappingBuffer_?n+=this.getCharBytes_(this.mappingBuffer_[e-r.getBegin()+r.getOffset()]):n+=this.unknownCharBytes_;break;case E.Reference.GB18030_UNICODE_SP_MAPPING:n+=4}else n+=this.unknownCharBytes_;return n},N.prototype.write=function(t,e,r){var n,o=0,i=this.segments_.find(t);if(!i)return m.writeUInt32BE(e,r,this.unknownChar_,this.unknownCharBytes_),this.unknownCharBytes_;switch(i.getReference()){case E.Reference.ASCII:e[r]=t,o=1;break;case E.Reference.BUFFER:if(!this.mappingBuffer_)return m.writeUInt32BE(e,r,this.unknownChar_,this.unknownCharBytes_),this.unknownCharBytes_;n=this.mappingBuffer_[t-i.getBegin()+i.getOffset()],o=this.getCharBytes_(n),m.writeUInt32BE(e,r,n,o);break;case E.Reference.GB18030_UNICODE_SP_MAPPING:n=v.convertUnicodeSPToGB18030(t),o=4,m.writeUInt32BE(e,r,n,o)}return o},r.UTF16LE=new U,r.UTF16BE=new C,r.UTF8=new b,r.Multibyte=N;const{UTF8:F,UTF16LE:w,UTF16BE:A}=r;var O=function(t){return 0===t.length?"00":1===t.length?"0"+t:t};e.toCodePoints=function(t){if(!t)return null;for(var e=t.length,r=[],n=0,o=0;o<e;++o){var i=t.codePointAt(o);r[n++]=i,i>65535&&o++}return r.slice(0,n)},e.toUTF8Binary=function(t){return F.unparse(t,!0)},e.toUTF8Hex=function(t){var e=F.unparse(t,!0);return e?e.map((t=>O(t.toString(16).toUpperCase()))):null},e.toUTF16LEBinary=function(t){return w.unparse(t,!0)},e.toUTF16LEHex=function(t){var e=w.unparse(t,!0);return e?e.map((t=>O(t.toString(16).toUpperCase()))):null},e.toUTF16BEBinary=function(t){return A.unparse(t,!0)},e.toUTF16BEHex=function(t){var e=A.unparse(t,!0);return e?e.map((t=>O(t.toString(16).toUpperCase()))):null};var R={};const T=n;var D=function(t,e,r){this.decoder_=t,this.encoder_=e,r&&(this.converters_=T.isArray(r)?r.slice():[r])};D.prototype.decoder_,D.prototype.encoder_,D.prototype.converters_,D.prototype.match=function(t){return this.decoder_.match(t)},D.prototype.process=function(t){var e=this.decoder_.decode(t);return e?(this.converters_&&this.converters_.forEach((function(t){e=t.convert(e)}),this),this.encoder_.encode(e)):null},R.Channel=D;var I={};var S=function(t,e){this.name_=t,this.type_=e};S.prototype.name_,S.prototype.type_,S.prototype.description_,S.prototype.version_,S.prototype.getName=function(){return this.name_},S.prototype.getType=function(){return this.type_},I.CharmapType={DECODER:"decoder",CONVERTER:"converter",ENCODER:"encoder"},I.Charmap=S;var M={},P={};const k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";P.encode=function(t){if(!t)return"";var e=t.length;if(!e)return"";for(var r=[],n=e%3,o=e-n,i=0,s=0,u=0;u<o;u+=3)i=t[u]<<16|t[u+1]<<8|t[u+2],r[s++]=k[i>>>18&63],r[s++]=k[i>>>12&63],r[s++]=k[i>>>6&63],r[s++]=k[63&i];return 1===n?(r[s++]=k[t[o]>>>2&63],r[s++]=k[t[o]<<4&48],r[s++]="=",r[s]="="):2===n&&(r[s++]=k[t[o]>>>2&63],r[s++]=k[t[o]<<4&48|t[o+1]>>>4&15],r[s++]=k[t[o+1]<<2&60],r[s]="="),r.join("")};const L=function(){for(var t={},e=0;e<64;++e)t[k[e]]=e;return t}();P.decode=function(t){if(!t)return new Uint8Array(0);var e=t.length;if(!e)return new Uint8Array(0);t.endsWith("==")?(t=t.substring(0,e-2),e-=2):t.endsWith("=")&&(t=t.substring(0,e-1),e-=1);var r=e%4,n=3*Math.floor(e/4);if(0!==r){if(1===r)throw"Invalid base64 string.";var o=L[t[e-1]];if(void 0===o)throw"Invalid base64 string.";if(2===r&&0!=(15&o))throw"Invalid base64 string.";if(3===r&&0!=(3&o))throw"Invalid base64 string.";n+=2===r?1:2}for(var i,s,u,f,a=new Uint8Array(n),c=e-r,h=0,p=0,_=0;_<c;_+=4){if(i=L[t[_]],s=L[t[_+1]],u=L[t[_+2]],f=L[t[_+3]],void 0===i||void 0===s||void 0===u||void 0===f)throw"Invalid base64 string.";h=i<<18|s<<12|u<<6|f,a[p++]=h>>>16&255,a[p++]=h>>>8&255,a[p++]=255&h}if(2===r){if(i=L[t[c]],s=L[t[c+1]],void 0===i)throw"Invalid base64 string.";a[p]=i<<2|s>>>4}else if(3===r){if(i=L[t[c]],s=L[t[c+1]],u=L[t[c+2]],void 0===i||void 0===s)throw"Invalid base64 string.";a[p++]=i<<2|s>>>4,a[p]=(15&s)<<4|u>>>2}return a};const{Charmap:x,CharmapType:K}=I,W=_,G=n,j=s,H=P;var Y=function(t){if(!t||!t.name)throw"options should provide name property at least";if(x.call(this,t.name,K.CONVERTER),this.description_=t.description,this.version_=t.version,this.segments_=new j.Segments(t.segments),this.mappingBuffer_=null,t.buffer)if(t.buffer instanceof Uint16Array||t.buffer instanceof Uint32Array)this.mappingBuffer_=t.buffer;else if(G.isString(t.buffer)&&t.buffer.startsWith(W.EMBEDDED_BASE64_PREFIX)){var e=t.buffer.substring(W.EMBEDDED_BASE64_PREFIX.length),r=H.decode(e.trim());this.mappingBuffer_=2===t.byte?new Uint16Array(r.buffer):new Uint32Array(r.buffer)}};G.inherits(Y,x),Y.prototype.description_,Y.prototype.version_,Y.prototype.segments_,Y.prototype.mappingBuffer_,Y.prototype.getBytesOfCodepoint=function(){return this.mappingBuffer_?this.mappingBuffer_ instanceof Uint16Array?2:this.mappingBuffer_ instanceof Uint32Array?4:0:0},Y.prototype.convert=function(t){if(!t)return null;for(var e=new Uint32Array(t.length),r=0,n=t.length;r<n;++r)e[r]=this.convertChar_(t[r]);return e},Y.prototype.convertChar_=function(t){t>>>=0;var e=this.segments_.find(t);if(!e)return W.UNICODE_UNKNOWN_CHAR;switch(e.getReference()){case j.Reference.SELF:return t;case j.Reference.BUFFER:return this.mappingBuffer_?this.mappingBuffer_[t-e.getBegin()+e.getOffset()]:W.UNICODE_UNKNOWN_CHAR;default:return W.UNICODE_UNKNOWN_CHAR}},M.Converter=Y;var X={},$={};const{Condition:V}=u,z=n,q=_,J=s,Q=p;var Z=function(){};Z.prototype.decode=function(t,e){var r=this.test(t,e);if(-1===r)return null;for(var n,o=new Uint32Array(r),i=z.isNumber(e)?e:0,s=0,u=t.length;i<u;++s){if(0===(n=this.consume(t,i,o,s)))return null;i+=n}return o},Z.prototype.parse=function(t,e){for(var r,n=[],o=0,i=z.isNumber(e)?e:0,s=t.length;i<s;){if(!(r=this.read(t,i)))return"";n[o++]=r.decoded,i+=r.consumed}return n.join("")},Z.prototype.match=function(t,e){return-1!==this.test(t,e)},Z.prototype.test=z.abstractMethod,Z.prototype.consume=z.abstractMethod,Z.prototype.read=z.abstractMethod;var tt=function(){Z.call(this)};z.inherits(tt,Z),tt.prototype.test=function(t,e){var r=z.isNumber(e)?e:0;if(!t)return-1;if(0===t.length)return 0;var n=t.length-r;if(n<=0)return 0;if(!0&n)return-1;for(var o,i,s,u=0,f=r,a=t.length;f<a;){if(s=0,(o=t[f]|t[f+1]<<8)<=55295||o>=57344?(u+=1,s=2):o>=55296&&o<=56319&&f+3<a&&(i=t[f+2]|t[f+3]<<8)>=56320&&i<=57343&&(u+=1,s=4),!s)return-1;f+=s}return u},tt.prototype.consume=function(t,e,r,n){var o=t[e]|t[e+1]<<8,i=2;o>=55296&&o<=56319&&(o=65536+((1023&o)<<10|1023&(t[e+2]|t[e+3]<<8)),i=4);return r[n]=o,i},tt.prototype.read=function(t,e){var r=t.length;if(e+1>=r)return null;var n,o=t[e]|t[e+1]<<8,i=2;if(o>=55296&&o<=56319){if(e+3>=r)return null;if((n=t[e+2]|t[e+3]<<8)<56320||n>57343)return null;i=4}return{consumed:i,decoded:2===i?String.fromCharCode(o):String.fromCharCode(o)+String.fromCharCode(n)}};var et=function(){Z.call(this)};z.inherits(et,Z),et.prototype.test=function(t,e){var r=z.isNumber(e)?e:0;if(!t)return-1;if(0===t.length)return 0;var n=t.length-r;if(n<=0)return 0;if(!0&n)return-1;for(var o,i,s,u=0,f=r,a=t.length;f<a;){if(s=0,(o=t[f]<<8|t[f+1])<=55295||o>=57344?(u+=1,s=2):o>=55296&&o<=56319&&f+3<a&&(i=t[f+2]<<8|t[f+3])>=56320&&i<=57343&&(u+=1,s=4),!s)return-1;f+=s}return u},et.prototype.consume=function(t,e,r,n){var o=t[e]<<8|t[e+1],i=2;o>=55296&&o<=56319&&(o=65536+((1023&o)<<10|1023&(t[e+2]<<8|t[e+3])),i=4);return r[n]=o,i},et.prototype.read=function(t,e){var r=t.length;if(e+1>=r)return null;var n,o=t[e]<<8|t[e+1],i=2;if(o>=55296&&o<=56319){if(e+3>=r)return null;if((n=t[e+2]<<8|t[e+3])<56320||n>57343)return null;i=4}return{consumed:i,decoded:2===i?String.fromCharCode(o):String.fromCharCode(o)+String.fromCharCode(n)}};var rt=function(){Z.call(this)};z.inherits(rt,Z),rt.prototype.test=function(t,e){var r=z.isNumber(e)?e:0;if(!t)return-1;if(0===t.length||t.length-r<=0)return 0;for(var n=0,o=r,i=t.length;o<i;)if(0==(128&t[o]))o++,n++;else if(o+1<i&&192==(224&t[o])&&128==(192&t[o+1]))o+=2,n++;else if(o+2<i&&224==(240&t[o])&&128==(192&t[o+1])&&128==(192&t[o+2]))o+=3,n++;else if(o+3<i&&240==(248&t[o])&&128==(192&t[o+1])&&128==(192&t[o+2])&&128==(192&t[o+3]))o+=4,n++;else if(o+4<i&&248==(252&t[o])&&128==(192&t[o+1])&&128==(192&t[o+2])&&128==(192&t[o+3])&&128==(192&t[o+4]))o+=5,n++;else{if(!(o+5<i&&252==(254&t[o])&&128==(192&t[o+1])&&128==(192&t[o+2])&&128==(192&t[o+3])&&128==(192&t[o+4])&&128==(192&t[o+5])))return-1;o+=6,n++}return n},rt.prototype.consume=function(t,e,r,n){return 0==(128&t[e])?(r[n]=t[e],1):192==(224&t[e])?(r[n]=(63&t[e])<<6|63&t[e+1],2):224==(240&t[e])?(r[n]=(31&t[e])<<12|(63&t[e+1])<<6|63&t[e+2],3):240==(248&t[e])?(r[n]=(15&t[e])<<18|(63&t[e+1])<<12|(63&t[e+2])<<6|63&t[e+3],4):248==(252&t[e])?(r[n]=(7&t[e])<<24|(63&t[e+1])<<18|(63&t[e+2])<<12|(63&t[e+3])<<6|63&t[e+4],5):252==(254&t[e])?(r[n]=(3&t[e])<<30|(63&t[e+1])<<24|(63&t[e+2])<<18|(63&t[e+3])<<12|(63&t[e+4])<<6|63&t[e+5],6):0},rt.prototype.read=function(t,e){var r,n=t.length;return 0==(128&t[e])?(r=t[e],{consumed:1,decoded:String.fromCharCode(r)}):e+1<n&&192==(224&t[e])&&128==(192&t[e+1])?(r=(63&t[e])<<6|63&t[e+1],{consumed:2,decoded:String.fromCharCode(r)}):e+2<n&&224==(240&t[e])&&128==(192&t[e+1])&&128==(192&t[e+2])?(r=(31&t[e])<<12|(63&t[e+1])<<6|63&t[e+2],{consumed:3,decoded:String.fromCharCode(r)}):e+3<n&&240==(248&t[e])&&128==(192&t[e+1])&&128==(192&t[e+2])&&128==(192&t[e+3])?(r=(15&t[e])<<18|(63&t[e+1])<<12|(63&t[e+2])<<6|63&t[e+3],{consumed:4,decoded:String.fromCodePoint(r)}):e+4<n&&248==(252&t[e])&&128==(192&t[e+1])&&128==(192&t[e+2])&&128==(192&t[e+3])&&128==(192&t[e+4])?(r=(7&t[e])<<24|(63&t[e+1])<<18|(63&t[e+2])<<12|(63&t[e+3])<<6|63&t[e+4],{consumed:5,decoded:String.fromCodePoint(r)}):e+5<n&&252==(254&t[e])&&128==(192&t[e+1])&&128==(192&t[e+2])&&128==(192&t[e+3])&&128==(192&t[e+4])&&128==(192&t[e+5])?(r=(3&t[e])<<30|(63&t[e+1])<<24|(63&t[e+2])<<18|(63&t[e+3])<<12|(63&t[e+4])<<6|63&t[e+5],{consumed:6,decoded:String.fromCodePoint(r)}):null};var nt=function(t,e,r){Z.call(this),this.conditions_=[],t&&z.isArray(t)&&t.forEach((function(t){var e=V.build(t.condition);e&&this.conditions_.push(e)}),this),this.segments_=new J.Segments(e),this.mappingBuffer_=r};z.inherits(nt,Z),nt.prototype.conditions_,nt.prototype.mappingBuffer_,nt.prototype.segments_,nt.prototype.getBytesOfCodepoint=function(){return this.mappingBuffer_?this.mappingBuffer_ instanceof Uint16Array?2:this.mappingBuffer_ instanceof Uint32Array?4:0:0},nt.prototype.test=function(t,e){var r=z.isNumber(e)?e:0;if(!this.conditions_.length||!t)return-1;if(0===t.length||t.length-r<=0)return 0;for(var n,o=0,i=r,s=t.length;i<s;){if(!(n=this.find_(t,i)))return-1;i+=n.getBytes(),o++}return o},nt.prototype.match=function(t,e){var r,n=z.isNumber(e)?e:0;if(!this.conditions_.length||!t)return!1;if(0===t.length||t.length-n<=0)return!0;for(var o=n,i=t.length;o<i;){if(!(r=this.find_(t,o)))return!1;var s=this.readUInt32BE_(t,o,r.getBytes());if(this.convertChar_(s)===q.UNICODE_UNKNOWN_CHAR)return!1;o+=r.getBytes()}return!0},nt.prototype.find_=function(t,e){for(var r=0,n=this.conditions_.length;r<n;++r)if(this.conditions_[r].consume(t,e))return this.conditions_[r];return null},nt.prototype.consume=function(t,e,r,n){var o=this.find_(t,e);if(!o)return 0;var i=o.getBytes(),s=this.readUInt32BE_(t,e,i);return r[n]=this.convertChar_(s),i},nt.prototype.read=function(t,e){var r=this.find_(t,e);if(!r)return null;var n=r.getBytes(),o=this.readUInt32BE_(t,e,n),i=this.convertChar_(o);return{consumed:n,decoded:String.fromCodePoint(i)}},nt.prototype.readUInt32BE_=function(t,e,r){for(var n=0,o=0;o<r;++o)n|=t[e+o]<<8*(r-1-o);return n>>>0},nt.prototype.convertChar_=function(t){t>>>=0;var e=this.segments_.find(t);if(!e)return q.UNICODE_UNKNOWN_CHAR;switch(e.getReference()){case J.Reference.ASCII:return 127&t;case J.Reference.UNDEFINED:return q.UNICODE_UNKNOWN_CHAR;case J.Reference.BUFFER:return this.mappingBuffer_?this.mappingBuffer_[t-e.getBegin()+e.getOffset()]:q.UNICODE_UNKNOWN_CHAR;case J.Reference.INDEXING_BUFFER:if(!this.mappingBuffer_)return q.UNICODE_UNKNOWN_CHAR;var r=this.getIndexingBufferOffset_(e,t);return-1===r?q.UNICODE_UNKNOWN_CHAR:this.mappingBuffer_[r+e.getOffset()];case J.Reference.SELF:return t;case J.Reference.GB18030_UNICODE_SP_MAPPING:return Q.convertGB18030ToUnicodeSP(t);default:return q.UNICODE_UNKNOWN_CHAR}},nt.prototype.getIndexingBufferOffset_=function(t,e){var r=t.getCondition();return r?r.getIndexingOffset(e):-1},$.Multibyte=nt,$.UTF16LE=new tt,$.UTF16BE=new et,$.UTF8=new rt;const{Charmap:ot,CharmapType:it}=I,st=_,ut=$,ft=n,at=P;var ct=function(t){ot.call(this,t,it.DECODER)};ft.inherits(ct,ot),ct.prototype.rule_,ct.prototype.match=ft.abstractMethod,ct.prototype.decode=ft.abstractMethod,ct.prototype.parse=ft.abstractMethod;var ht=function(){ct.call(this,"UTF-16LE"),this.rule_=ut.UTF16LE};ft.inherits(ht,ct),ht.prototype.match=function(t,e){return this.rule_.match(t,e)},ht.prototype.hasBom=function(t){return t&&t.length>=2&&t[0]===st.UTF16LE_BOM[0]&&t[1]===st.UTF16LE_BOM[1]},ht.prototype.decode=function(t,e){return this.rule_.decode(t,e)},ht.prototype.parse=function(t,e){var r=this.rule_.parse(t,e);return r&&r.charCodeAt(0)===st.UNICODE_BYTE_ORDER_MARK?r.substring(1):r};var pt=function(){ct.call(this,"UTF-16BE"),this.rule_=ut.UTF16BE};ft.inherits(pt,ct),pt.prototype.match=function(t,e){return this.rule_.match(t,e)},pt.prototype.hasBom=function(t){return t&&t.length>=2&&t[0]===st.UTF16BE_BOM[0]&&t[1]===st.UTF16BE_BOM[1]},pt.prototype.decode=function(t,e){return this.rule_.decode(t,e)},pt.prototype.parse=function(t,e){var r=this.rule_.parse(t,e);return r&&r.charCodeAt(0)===st.UNICODE_BYTE_ORDER_MARK?r.substring(1):r};var _t=function(){ct.call(this,"UTF-8"),this.rule_=ut.UTF8};ft.inherits(_t,ct),_t.prototype.match=function(t,e){return this.rule_.match(t,e)},_t.prototype.hasBom=function(t){return t&&t.length>=3&&t[0]===st.UTF8_BOM[0]&&t[1]===st.UTF8_BOM[1]&&t[2]===st.UTF8_BOM[2]},_t.prototype.decode=function(t,e){return this.rule_.decode(t,e)},_t.prototype.parse=function(t,e){var r=this.rule_.parse(t,e);return r&&r.charCodeAt(0)===st.UNICODE_BYTE_ORDER_MARK?r.substring(1):r};var dt=function(t){if(!t||!t.name)throw"options should provide name property at least";ct.call(this,t.name),this.description_=t.description,this.version_=t.version;var e=null;if(t.buffer)if(t.buffer instanceof Uint16Array||t.buffer instanceof Uint32Array)e=t.buffer;else if(ft.isString(t.buffer)&&t.buffer.startsWith(st.EMBEDDED_BASE64_PREFIX)){var r=t.buffer.substring(st.EMBEDDED_BASE64_PREFIX.length),n=at.decode(r.trim());e=2===t.byte?new Uint16Array(n.buffer):new Uint32Array(n.buffer)}this.rule_=new ut.Multibyte(t.rules,t.segments,e)};ft.inherits(dt,ct),dt.prototype.getBytesOfCodepoint=function(){return this.rule_.getBytesOfCodepoint()},dt.prototype.match=function(t,e){return this.rule_.match(t,e)},dt.prototype.decode=function(t,e){return this.rule_.decode(t,e)},dt.prototype.parse=function(t,e){return this.rule_.parse(t,e)},X.UTF16LE=new ht,X.UTF16BE=new pt,X.UTF8=new _t,X.Decoder=ct,X.Multibyte=dt;var lt={};const{Charmap:yt,CharmapType:gt}=I,Et=_,vt=r,mt=n,Bt=P;var Ut=function(t){yt.call(this,t,gt.ENCODER)};mt.inherits(Ut,yt),Ut.prototype.rule_,Ut.prototype.encode=mt.abstractMethod,Ut.prototype.unparse=mt.abstractMethod;var Ct=function(){Ut.call(this,"UTF-16LE"),this.rule_=vt.UTF16LE};mt.inherits(Ct,Ut),Ct.prototype.encode=function(t){return this.rule_.encode(t)},Ct.prototype.unparse=function(t,e){if(!mt.isString(t))throw"Error: invalid type for str.";return e&&t.codePointAt(0)!==Et.UNICODE_BYTE_ORDER_MARK&&(t=String.fromCodePoint(Et.UNICODE_BYTE_ORDER_MARK)+t),this.rule_.unparse(t)};var bt=function(){Ut.call(this,"UTF-16BE"),this.rule_=vt.UTF16BE};mt.inherits(bt,Ut),bt.prototype.encode=function(t){return this.rule_.encode(t)},bt.prototype.unparse=function(t,e){if(!mt.isString(t))throw"Error: invalid type for str.";return e&&t.codePointAt(0)!==Et.UNICODE_BYTE_ORDER_MARK&&(t=String.fromCodePoint(Et.UNICODE_BYTE_ORDER_MARK)+t),this.rule_.unparse(t)};var Nt=function(){Ut.call(this,"UTF-8"),this.rule_=vt.UTF8};mt.inherits(Nt,Ut),Nt.prototype.encode=function(t){return this.rule_.encode(t)},Nt.prototype.unparse=function(t,e){if(!mt.isString(t))throw"Error: invalid type for str.";return e&&t.codePointAt(0)!==Et.UNICODE_BYTE_ORDER_MARK&&(t=String.fromCodePoint(Et.UNICODE_BYTE_ORDER_MARK)+t),this.rule_.unparse(t)};var Ft=function(t){if(!t||!t.name)throw"options should provide name property at least";Ut.call(this,t.name),this.description_=t.description,this.version_=t.version;var e=null;if(t.buffer)if(t.buffer instanceof Uint16Array||t.buffer instanceof Uint32Array)e=t.buffer;else if(mt.isString(t.buffer)&&t.buffer.startsWith(Et.EMBEDDED_BASE64_PREFIX)){var r=t.buffer.substring(Et.EMBEDDED_BASE64_PREFIX.length),n=Bt.decode(r.trim());e=2===t.byte?new Uint16Array(n.buffer):new Uint32Array(n.buffer)}this.rule_=new vt.Multibyte(t.segments,e,Et.MBCS_UNKNOWN_CHAR)};mt.inherits(Ft,Ut),Ft.prototype.getBytesOfCodepoint=function(){return this.rule_.getBytesOfCodepoint()},Ft.prototype.encode=function(t){return this.rule_.encode(t)},Ft.prototype.unparse=function(t){if(!mt.isString(t))throw"Error: invalid type for str.";return this.rule_.unparse(t)},lt.UTF16LE=new Ct,lt.UTF16BE=new bt,lt.UTF8=new Nt,lt.Encoder=Ut,lt.Multibyte=Ft;var wt={};const{Channel:At}=R,{Converter:Ot}=M,Rt=X,Tt=lt,Dt=n;var It=function(t){this.reload(t)};It.prototype.encoders_,It.prototype.decoders_,It.prototype.converters_,It.prototype.channels_,It.prototype.detectionOrder_,It.prototype.reload=function(t){this.decoders_={},this.decoders_[Rt.UTF8.getName()]=Rt.UTF8,this.decoders_[Rt.UTF16LE.getName()]=Rt.UTF16LE,this.decoders_[Rt.UTF16BE.getName()]=Rt.UTF16BE,this.encoders_={},this.encoders_[Tt.UTF8.getName()]=Tt.UTF8,this.encoders_[Tt.UTF16LE.getName()]=Tt.UTF16LE,this.encoders_[Tt.UTF16BE.getName()]=Tt.UTF16BE,this.converters_={},this.detectionOrder_=[],this.channels_={},t&&(Dt.isArray(t.decoders)&&t.decoders.forEach((t=>{var e=new Rt.Multibyte(t);this.decoders_[e.getName()]=e}),this),Dt.isArray(t.detection_order)&&(this.detectionOrder_=t.detection_order.slice()),Dt.isArray(t.encoders)&&t.encoders.forEach((t=>{var e=new Tt.Multibyte(t);this.encoders_[e.getName()]=e}),this),Dt.isArray(t.converters)&&t.converters.forEach((t=>{var e=new Ot(t);this.converters_[e.getName()]=e}),this),Dt.isArray(t.channels)&&t.channels.forEach((t=>{this.newChannel(t.name,t.decoder,t.encoder,t.converters)}),this))},It.prototype.getDecoder=function(t){return this.decoders_[t]},It.prototype.getDecoderNames=function(){return Object.keys(this.decoders_)},It.prototype.getEncoder=function(t){return this.encoders_[t]},It.prototype.getEncoderNames=function(){return Object.keys(this.encoders_)},It.prototype.getConverter=function(t){return this.converters_[t]},It.prototype.getConverterNames=function(){return Object.keys(this.converters_)},It.prototype.getChannel=function(t){return this.channels_[t]},It.prototype.getChannelNames=function(){return Object.keys(this.channels_)},It.prototype.newChannel=function(t,e,r,n){if(!this.decoders_[e]||!this.encoders_[r])return null;var o=[];return n&&(Dt.isString(n)?this.converters_[n]&&o.push(this.converters_[n]):Dt.isArray(n)&&n.forEach((t=>{this.converters_[t]&&o.push(this.converters_[t])}),this)),this.channels_[t]=new At(this.decoders_[e],this.encoders_[r],o)},It.prototype.decode=function(t,e,r){var n=this.getDecoder(e);if(!n)throw`Error: decoder ${e} not found in the context.`;return n.decode(t,r)},It.prototype.encode=function(t,e){var r=this.getEncoder(e);if(!r)throw`Error: encoder ${e} not found in the context.`;return r.encode(t)},It.prototype.parse=function(t,e,r){var n=this.getDecoder(e);if(!n)throw`Error: decoder ${e} not found in the context.`;return n.parse(t,r)},It.prototype.unparse=function(t,e,r){var n=this.getEncoder(e);if(!n)throw`Error: encoder ${e} not found in the context.`;return n.unparse(t,r)},It.prototype.findPossibleEncoding=function(t){if(Rt.UTF8.match(t))return{encoding:Rt.UTF8.getName(),hasBom:Rt.UTF8.hasBom(t)};if(Rt.UTF16LE.hasBom(t)&&Rt.UTF16LE.match(t))return{encoding:Rt.UTF16LE.getName(),hasBom:!0};if(Rt.UTF16BE.hasBom(t)&&Rt.UTF16BE.match(t))return{encoding:Rt.UTF16BE.getName(),hasBom:!0};var e=this.detectionOrder_.find((e=>{var r=this.getDecoder(e);return r&&r.match(t)}),this);return e?{encoding:e,hasBom:!1}:null},wt.Context=It;var St={};const{Context:Mt}=wt,Pt=n,kt=_;St.loadFromUrl=function(t){var e=fetch(t).then((t=>t.json())),r=function(t){return Pt.isString(t.buffer)&&!t.buffer.startsWith(kt.EMBEDDED_BASE64_PREFIX)?fetch(t.buffer).then((t=>t.arrayBuffer())).then((e=>{t.buffer=2===t.byte?new Uint16Array(e):new Uint32Array(e)})):Promise.resolve()};return(e=e.then((t=>{var e=[];return Pt.isArray(t.decoders)&&t.decoders.forEach((t=>{e.push(r(t))})),Pt.isArray(t.encoders)&&t.encoders.forEach((t=>{e.push(r(t))})),Pt.isArray(t.converters)&&t.converters.forEach((t=>{e.push(r(t))})),Promise.all(e).then((()=>t))}))).then((t=>new Mt(t)))};const Lt=t,xt=e,{Channel:Kt}=R,{CharmapType:Wt}=I,{Condition:Gt}=u,jt=_,{Converter:Ht}=M,Yt=X,Xt=lt,{Reference:$t}=s,{Context:Vt}=wt,zt=P,{loadFromUrl:qt}=St;return{Converter:Ht,DecoderMultibyte:Yt.Multibyte,DECODER_UTF8:Yt.UTF8,DECODER_UTF16LE:Yt.UTF16LE,DECODER_UTF16BE:Yt.UTF16BE,EncoderMultibyte:Xt.Multibyte,ENCODER_UTF8:Xt.UTF8,ENCODER_UTF16LE:Xt.UTF16LE,ENCODER_UTF16BE:Xt.UTF16BE,Channel:Kt,Condition:Gt,CharmapType:Wt,SegmentReference:$t,Context:Vt,Consts:jt,utils:{buffer:Lt,utf:xt,base64:zt},loadFromUrl:qt}}));
